name: Manual website deployment

run-name: Trigger website deployment to GitHub Pages

on:
  workflow_dispatch:

permissions:
  actions: write
  contents: write

jobs:
  trigger-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '14'

      - name: Install @octokit/rest
        run: npm install @octokit/rest

      - name: Call Deploy Workflow
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            try {
              const triggerUser = '${{ github.actor }}';

              // Use dynamic import for ES module
              const { Octokit } = await import('@octokit/rest');

              const octokit = new Octokit({ auth: process.env.GITHUB_TOKEN });

              const response = await octokit.actions.createWorkflowDispatch({
                owner: context.repo.owner,
                repo: context.repo.repo,
                workflow_id: 'deploy.yml',
                ref: 'website',
                inputs: {
                  triggerUser: triggerUser,
                },
              });

              console.log(response);
            } catch (error) {
              console.error('Error:', error);
              throw error;
            }
